#!/bin/sh
# Updates your fork by rebasing your latest commits on top of changes from official casa
# Usage:
#   update
#     updates main and the current branch

echo "INFO: Attempting to update local repo"

# Please set this to the name of your remote the points to official casa before using
UPSTREAM_REMOTE="actual_casa"
BRANCH_TO_UPDATE="$(git branch --show-current)"

if test -z "$(git branch --list ${BRANCH_TO_UPDATE})"; then
  echo "ERROR: Could not find branch $BRANCH_TO_UPDATE"
  exit 1
fi

echo "INFO: Fetching updates from upsteam"
git fetch $UPSTREAM_REMOTE

echo "INFO: Updating main"
git checkout main
git merge --ff-only $UPSTREAM_REMOTE/main

if test $BRANCH_TO_UPDATE != "main"; then
  echo "INFO: Updating $BRANCH_TO_UPDATE"
  git checkout $BRANCH_TO_UPDATE
  git rebase -r $UPSTREAM_REMOTE/main
fi
